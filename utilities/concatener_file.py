# -*- coding: utf-8 -*-
"""
Created on Mon Nov 21 14:33:07 2022

@author: chaze
"""

import os
import glob
import json

ajout = 45
folder_dir = "data_stop"

#%%
#Change image folder 
#change file names by adding thousands
folder_dirI = folder_dir + "/images" 
for iname in glob.glob(f'{folder_dirI}/*.jpg'):
    print(iname)
    try:
        ancien = iname.split("_")[1] #changes according to the file name 
        ancien = int(ancien.split("\\")[1])
        nouveau = folder_dirI + "\\" + str(ancien + ajout*1000) + "_cam_image_array_.jpg"
        os.rename(iname, nouveau) 
    except:
        print("ya soucis1")
        
#%%
#Changing catalog files
#change file names by adding thousands
#change value of the key dico: "cam/image_array" , "index" 
nb=0
for iname in glob.glob(f'{folder_dir}/*.catalog'):
    try:
        nb +=1
        ancien = iname.split("_")[2]
        ancien = int(ancien.split(".")[0])
        nouveau = folder_dir + "\\catalog_" + str(ancien + ajout) + ".catalog"
        os.rename(iname, nouveau)
    except:
        print("ya soucis2")        
 
#%%    
for i in range(nb):
    add = []
    file = open(folder_dir + "\\catalog_" + str(i+ajout) + ".catalog", 'rb')
    for ligne in file:
        ligne = ligne.decode("utf-8") 
        ligne = json.loads(ligne)
        ligne["_index"] = ligne["_index"] +ajout*1000
        ligne["cam/image_array"] = str(int(ligne["cam/image_array"].split("_")[0])+ajout*1000) +"_cam_image_array_.jpg"
        ligne["_session_id"] = "22-11-30_0" #the right session
        add.append(ligne)
    file.close()
    file =  open(folder_dir + "\\catalog_" + str(i+ajout) + ".catalog", 'w')
    for ligne in add:
        file.write(str(ligne)+"\n")
    file.close()



#%%
#Modification of manifest files 
#change file names by adding thousands
#change value of the key dico: "path" et "start_index" 
        
for iname in glob.glob(f'{folder_dir}/*.catalog_manifest'):
    try:
        ancien = iname.split("_")[2]
        ancien = int(ancien.split(".")[0])
        nouveau = folder_dir + "\\catalog_" + str(ancien + ajout) + ".catalog_manifest"
        os.rename(iname, nouveau)
    except:
        print("ya soucis3")
        
#%%
for i in range(nb):
    add = []
    ligne , ligne2, ligne3, ligne4= "", "", "", ""
    file = open(folder_dir + "\\catalog_" + str(i+ajout) + ".catalog_manifest", 'rb')
    for ligne in file:
        ligne = ligne.decode("utf-8")
        ligne = ligne.split("]")[0] + '], "path": "catalog_' + str(int(ligne.split("]")[-1].split(",")[1].split("_")[1].split(".")[0]) + ajout) + '.catalog_manifest", "start_index": ' + str(int(ligne.split("]")[-1].split(":")[-1].strip().strip("}").strip()) + ajout*1000) + "}"
        add.append(ligne)
    file.close()
    file =  open(folder_dir + "\\catalog_" + str(i+ajout) + ".catalog_manifest", 'w')
    for ligne in add:
        file.write(str(ligne)+"\n")
    file.close()
    
        
#%%
ligne ='{"created_at": 1668694063.2732878, "line_lengths": [190, 190, 190, 190, 190, 190, 190, 190, 190, 205, 205, 205, 205, 205, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 192, 206, 191, 191, 206, 192, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 205, 205, 205, 205, 205, 205, 205, 205, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 205, 205, 205, 191, 191, 205, 205, 205, 205, 205, 205, 206, 221, 221, 221, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 205, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 207, 221, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 205, 205, 205, 205, 205, 205, 205, 205, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 191, 220, 207, 221, 207, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 205, 205, 205, 205, 205, 205, 205, 220, 220, 207, 221, 221, 207, 221, 221, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 191, 191, 191, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 205, 206, 207, 208, 206, 206, 192, 192, 206, 206, 206, 206, 206, 206, 206, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 191, 191, 191, 191, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 205, 191, 221, 208, 192, 206, 192, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 205, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 207, 221, 206, 192, 192, 192, 206, 206, 206, 206, 192, 206, 206, 192, 206, 206, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 191, 191, 191, 191, 191, 191, 191, 191, 191, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 190, 191, 207, 221, 192, 206, 192, 206, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 206, 205, 205, 205, 205, 205, 205, 205, 205, 190, 190, 190, 190, 190], "path": "catalog_11.catalog_manifest", "start_index": 11000}'
print(ligne.split("]")[0] + '], "path": "catalog_' 
                + str(int(ligne.split("]")[1].split(",")[1].split("_")[1].split(".")[0]) + 1000000000 )
                +'.catalog_manifest", "start_index": '
                + str(int(ligne.split("]")[1].split(":")[-1].strip("}").strip()) + 1000000000)
                + "}")
        
        
        
        